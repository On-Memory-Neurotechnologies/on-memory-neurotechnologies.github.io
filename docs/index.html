<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>On Memory Neurotechnologies</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="favicon.ico" />
    <link rel="stylesheet" href="css/site.css" />

    <!-- import custom components -->
    <script src="js/data.js" type="text/javascript" defer></script>
    <script src="components/nav.js" type="text/javascript" defer></script>
    <script src="components/Disclaimer.js" type="text/javascript" defer></script>
    <script src="components/OnDementia.js" type="text/javascript" defer></script>
    <script src="components/MeetPat.js" type="text/javascript" defer></script>
    <script src="components/OMP.js" type="text/javascript" defer></script>
    <script src="components/Prosthesis1.js" type="text/javascript" defer></script>
    <script src="components/Prosthesis2.js" type="text/javascript" defer></script>
    <script src="components/Prosthesis3.js" type="text/javascript" defer></script>
    <script src="components/TestForms.js" type="text/javascript" defer></script>

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap"
      rel="stylesheet"
    />
  </head>
  <body onload="clientAction('login','POST');">
    <nav-bar></nav-bar>

    <div class="landing-page">
      <h1>On Memory Neurotechnologies</h1>
      <h3>An interactive article on memory prosthesesâ€”and how you can help design them</h3>
      <div class="buttons">
        <a onclick="changeDeck(1)" id="button1" class="white">Start a new session</a>
        <a onclick="
        let cookie = getCookie('prevSettings'); resetSettings(cookie)" id="button2" class="white">Continue last session</a>
      </div>
    </div>

    <div id="content"></div>

    <script>
      let currentDeck = -1;
      let currentSlide = 0;
      let scrollAnchor = 0;
      let collectData = false;
      let numTries = 0;
      let userId = undefined;

      let option = 'local';
      let url;
      if (option  === 'local'){
        url = new URL('http://localhost');
      } else if (option === 'server'){
        url = new URL('https://songlab.azurewebsites.net/');
      }

      let disclaimerDeck = {
        id: "disclaimer",
        slides: ["omn-disclaimer"],
      };

      let formsDeck = {
        id: "test-forms",
        slides: ["test-forms"],
      };

      let odDeck = {
        id: "on-dementia",
        slides: ["on-dementia", "meet-pat"],
      };

      let ompDeck = {
        id: "on-memory-prostheses",
        slides: [
          "on-memory-prostheses",
          "the-prosthesis-1",
          "the-prosthesis-2",
          "the-prosthesis-3",
        ],
      };

      let decks = [disclaimerDeck, formsDeck, odDeck, ompDeck];

      window.addEventListener("resize", goToScrollAnchor);

      function addDeck() {
        document.getElementById(
          "content"
        ).innerHTML += `<div id="${decks[currentDeck].id}" class="page"></div>`;
        placeSlideContent();
      }

      function insertProgressButton() {
        removeButtons()
        if (decks[currentDeck].slides.length == 1){
          document.getElementById(
                  decks[currentDeck].id
          ).innerHTML += `
<button class="move-button bottom" onclick="checkConsent();"><i class="arrow down"></i></button>
<button class="move-button top" onclick="changeDeck(-1)"><i class="arrow up"></i></button>`;
        }
        else if (currentSlide == decks[currentDeck].slides.length - 1) {
          if (currentDeck == decks.length - 1){
            document.getElementById(
                    decks[currentDeck].id
            ).innerHTML += `
<button class="move-button top" onclick="changeSlide(-1)"><i class="arrow up"></i></button>`;
          } else{
            document.getElementById(
                    decks[currentDeck].id
            ).innerHTML += `
<button class="move-button bottom" onclick="checkConsent();"><i class="arrow down"></i></button>
<button class="move-button top" onclick="changeSlide(-1)"><i class="arrow up"></i></button>`;
          }
        } else if (currentSlide == 0) {
          document.getElementById(
                  decks[currentDeck].id
          ).innerHTML += `
        <button class="move-button bottom" onclick="checkConsent();"><i class="arrow down"></i></button>
        <button class="move-button top" onclick="changeDeck(-1)"><i class="arrow up"></i></button>`;
        }
        else {
          document.getElementById(
            decks[currentDeck].id
          ).innerHTML += `
<button class="move-button bottom" onclick="checkConsent();"><i class="arrow down"></i></button>
<button class="move-button top" onclick="changeSlide(-1)"><i class="arrow up"></i></button>

`;
        }
      }

      function changeDeck(direction) {
        currentDeck += direction;
        if (currentDeck >= 0 && currentDeck <= decks.length - 1) {
            if (direction > 0){
            currentSlide = 0;
            let element = document.getElementById(decks[currentDeck].id);
            if (element === null) {
              addDeck(decks[currentDeck].slides[currentSlide]);
            }
          } else if (direction < 0) {
            currentSlide = decks[currentDeck].slides.length - 1;
          }
          insertProgressButton();

          // Reset and populate disclaimer slide
          if (decks[currentDeck].id == 'disclaimer'){
            collectData = undefined;
            displayUserId()
          }

        } else {
          currentSlide = 0;
        }
        moveViewport(direction);

      }

      function moveViewport(direction) {
        scrollAnchor += (direction * (window.innerHeight-50));
        window.scrollTo(0, scrollAnchor);
      }

      function goToScrollAnchor() {
        window.scrollTo(0, scrollAnchor);
      }

      function changeSlide(offset) {
        currentSlide += offset;
        placeSlideContent();
        insertProgressButton();
      }

      function placeSlideContent() {
        let viewName = decks[currentDeck].slides[currentSlide];
        document.getElementById(decks[currentDeck].id).innerHTML = `<${viewName}></${viewName}>`;
      }

      // document.addEventListener("scroll", function(){ // or window.addEventListener("scroll"....
      //   console.log('scroll')
      //   let st = window.pageYOffset || document.documentElement.scrollTop; // Credits: "https://github.com/qeremy/so/blob/master/so.dom.js#L426"
      //   if (st > scrollAnchor){
      //     if ((currentDeck == -1) || currentSlide == decks[currentSlide].slides.length-1){
      //       transitionToNextDeck();
      //     } else {
      //       nextSlide()
      //     }
      //   } else {
      //     if (currentSlide == 0 && currentDeck == -1){
      //       transitionToPreviousDeck();
      //     }
      //   }
      //   lastScrollTop = st <= 0 ? 0 : st; // For Mobile or negative scrolling
      // }, false);
    </script>
  </body>
</html>
