<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>On Memory Neurotechnologies</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="styles/favicon.ico" />
    <link rel="stylesheet" href="css/site.css" />

    <!-- import custom components -->
    <script src="components/nav.js" type="text/javascript" defer></script>
    <script src="components/Disclaimer.js" type="text/javascript" defer></script>
    <script src="components/OnDementia.js" type="text/javascript" defer></script>
    <script src="components/MeetPat.js" type="text/javascript" defer></script>
    <script src="components/OMP.js" type="text/javascript" defer></script>
    <script src="components/Prosthesis1.js" type="text/javascript" defer></script>
    <script src="components/Prosthesis2.js" type="text/javascript" defer></script>
    <script src="components/Prosthesis3.js" type="text/javascript" defer></script>

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav-bar></nav-bar>

    <div class="landing-page">
      <h1>On Memory Neurotechnologies</h1>
      <h3>An interactive article on memory prosthesesâ€”and how you can help design them</h3>
      <div class="buttons">
        <a onclick="transitionToNextDeck()" id="button1">Start a new session</a>
        <a href="#" id="button2">Continue last session</a>
      </div>
    </div>

    <div id="content"></div>

    <script>
      let currentDeck = -1;
      let currentSlide = 0;
      let scrollAnchor = 0;

      let disclaimerDeck = {
        id: "disclaimer",
        slides: ["omn-disclaimer"],
      };

      let odDeck = {
        id: "on-dementia",
        slides: ["on-dementia", "meet-pat"],
      };

      let ompDeck = {
        id: "on-memory-prostheses",
        slides: [
          "on-memory-prostheses",
          "the-prosthesis-1",
          "the-prosthesis-2",
          "the-prosthesis-3",
        ],
      };

      let decks = [disclaimerDeck, odDeck, ompDeck];

      window.addEventListener("resize", goToScrollAnchor);

      function addDeck() {
        document.getElementById(
          "content"
        ).innerHTML += `<div id="${decks[currentDeck].id}" class="page"></div>`;
        placeSlideContent();
      }

      function insertProgressButton() {
        if (decks[currentDeck].slides.length - 1 != currentSlide) {
          document.getElementById(
            decks[currentDeck].id
          ).innerHTML += `<button id="move-button" class="move-button" onclick="nextSlide()"><i class="arrow down"></i></button>`;
        } else {
          document.getElementById(
            decks[currentDeck].id
          ).innerHTML += `<button id="move-button" class="move-button" onclick="transitionToNextDeck()"><i class="arrow down"></i></button>`;
        }
      }

      function transitionToNextDeck() {
        currentDeck++;
        currentSlide = 0;
        let element = document.getElementById(decks[currentDeck].id);
        if (element === null) {
          addDeck(decks[currentDeck].slides[currentDeck]);
        }
        moveViewport();
        insertProgressButton();
      }

      function transitionToPreviousDeck() {
        currentDeck -= 1;
        currentSlide = decks[currentSlide].slides.length - 1;
        moveViewport();
        insertProgressButton();
      }

      function moveViewport() {
        let doc = document.body;
        let scale = 0.92;
        scrollAnchor = doc.scrollTop + doc.clientHeight * scale;
        window.scrollTo(0, scrollAnchor);
      }

      function goToScrollAnchor() {
        window.scrollTo(0, scrollAnchor);
      }

      function nextSlide() {
        currentSlide++;
        placeSlideContent();
        insertProgressButton();
      }

      function placeSlideContent() {
        let viewName = decks[currentDeck].slides[currentSlide];
        document.getElementById(decks[currentDeck].id).innerHTML = `<${viewName}></${viewName}>`;
      }

      // document.addEventListener("scroll", function(){ // or window.addEventListener("scroll"....
      //   console.log('scroll')
      //   let st = window.pageYOffset || document.documentElement.scrollTop; // Credits: "https://github.com/qeremy/so/blob/master/so.dom.js#L426"
      //   if (st > scrollAnchor){
      //     if ((currentDeck == -1) || currentSlide == decks[currentSlide].slides.length-1){
      //       transitionToNextDeck();
      //     } else {
      //       nextSlide()
      //     }
      //   } else {
      //     if (currentSlide == 0 && currentDeck == -1){
      //       transitionToPreviousDeck();
      //     }
      //   }
      //   lastScrollTop = st <= 0 ? 0 : st; // For Mobile or negative scrolling
      // }, false);
    </script>
  </body>
</html>
